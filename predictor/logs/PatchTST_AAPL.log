Args in experiment:
Namespace(random_seed=2021, is_training=1, model_id='AAPL_336_96', model='PatchTST', data='custom', root_path='./predictor/dataset/', data_path='AAPL.csv', result_path='./predictor/results/', features='M', target='Close', freq='1d', date_header='timestamp', seq_len=336, label_len=48, pred_len=96, fc_dropout=0.2, head_dropout=0.0, patch_len=16, stride=8, padding_patch='end', revin=1, affine=0, subtract_last=0, decomposition=1, kernel_size=25, individual=0, embed_type=0, enc_in=5, dec_in=5, c_out=7, d_model=128, n_heads=16, e_layers=3, decoder_layers=1, d_ff=256, moving_avg=25, factor=1, distil=True, dropout=0.2, embed='timeF', activation='gelu', output_attention=False, do_predict=False, num_workers=10, itr=1, train_epochs=100, batch_size=128, patience=20, learning_rate=0.0001, des='Exp', loss='mse', lradj='type3', pct_start=0.3, use_amp=False, use_gpu=True, gpu=0, use_multi_gpu=False, devices='0,1,2,3', test_flop=False)
Use GPU: cuda:0
>>>>>>>start training : AAPL_336_96_PatchTST_custom_ftM_sl336_ll48_pl96_dm128_nh16_el3_dl1_df256_fc1_ebtimeF_dtTrue_Exp_0>>>>>>>>>>>>>>>>>>>>>>>>>>
train 6757
val 933
test 1958
Epoch: 1 cost time: 9.101322174072266
Epoch: 1, Steps: 52 | Train Loss: 1.1314877 Vali Loss: 0.3053064 Test Loss: 0.3495633
Validation loss decreased (inf --> 0.305306).  Saving model ...
Updating learning rate to 0.0001
Epoch: 2 cost time: 8.119553804397583
Epoch: 2, Steps: 52 | Train Loss: 0.9982200 Vali Loss: 0.2576969 Test Loss: 0.3002260
Validation loss decreased (0.305306 --> 0.257697).  Saving model ...
Updating learning rate to 0.0001
Epoch: 3 cost time: 8.30239462852478
Epoch: 3, Steps: 52 | Train Loss: 0.9002150 Vali Loss: 0.2518048 Test Loss: 0.2962653
Validation loss decreased (0.257697 --> 0.251805).  Saving model ...
Updating learning rate to 0.0001
Epoch: 4 cost time: 8.17631459236145
Epoch: 4, Steps: 52 | Train Loss: 0.8812376 Vali Loss: 0.2513450 Test Loss: 0.2954668
Validation loss decreased (0.251805 --> 0.251345).  Saving model ...
Updating learning rate to 9e-05
Epoch: 5 cost time: 8.226799964904785
Epoch: 5, Steps: 52 | Train Loss: 0.8709858 Vali Loss: 0.2513322 Test Loss: 0.2953250
Validation loss decreased (0.251345 --> 0.251332).  Saving model ...
Updating learning rate to 8.1e-05
Epoch: 6 cost time: 8.259841442108154
Epoch: 6, Steps: 52 | Train Loss: 0.8621511 Vali Loss: 0.2504761 Test Loss: 0.2951749
Validation loss decreased (0.251332 --> 0.250476).  Saving model ...
Updating learning rate to 7.290000000000001e-05
Epoch: 7 cost time: 8.573309659957886
Epoch: 7, Steps: 52 | Train Loss: 0.8574202 Vali Loss: 0.2505399 Test Loss: 0.2951532
EarlyStopping counter: 1 out of 20
Updating learning rate to 6.561e-05
Epoch: 8 cost time: 8.479305267333984
Epoch: 8, Steps: 52 | Train Loss: 0.8530994 Vali Loss: 0.2509200 Test Loss: 0.2952111
EarlyStopping counter: 2 out of 20
Updating learning rate to 5.904900000000001e-05
Epoch: 9 cost time: 8.388054370880127
Epoch: 9, Steps: 52 | Train Loss: 0.8487625 Vali Loss: 0.2518278 Test Loss: 0.2951495
EarlyStopping counter: 3 out of 20
Updating learning rate to 5.3144100000000005e-05
Epoch: 10 cost time: 8.35311222076416
Epoch: 10, Steps: 52 | Train Loss: 0.8474308 Vali Loss: 0.2500689 Test Loss: 0.2951410
Validation loss decreased (0.250476 --> 0.250069).  Saving model ...
Updating learning rate to 4.782969000000001e-05
Epoch: 11 cost time: 8.417049169540405
Epoch: 11, Steps: 52 | Train Loss: 0.8451016 Vali Loss: 0.2505924 Test Loss: 0.2951641
EarlyStopping counter: 1 out of 20
Updating learning rate to 4.304672100000001e-05
Epoch: 12 cost time: 8.404953956604004
Epoch: 12, Steps: 52 | Train Loss: 0.8420758 Vali Loss: 0.2498350 Test Loss: 0.2952066
Validation loss decreased (0.250069 --> 0.249835).  Saving model ...
Updating learning rate to 3.874204890000001e-05
Epoch: 13 cost time: 8.458444356918335
Epoch: 13, Steps: 52 | Train Loss: 0.8413653 Vali Loss: 0.2507882 Test Loss: 0.2952991
EarlyStopping counter: 1 out of 20
Updating learning rate to 3.486784401000001e-05
Epoch: 14 cost time: 10.39198613166809
Epoch: 14, Steps: 52 | Train Loss: 0.8386379 Vali Loss: 0.2499060 Test Loss: 0.2952541
EarlyStopping counter: 2 out of 20
Updating learning rate to 3.138105960900001e-05
Epoch: 15 cost time: 9.235444784164429
Epoch: 15, Steps: 52 | Train Loss: 0.8361412 Vali Loss: 0.2492351 Test Loss: 0.2952674
Validation loss decreased (0.249835 --> 0.249235).  Saving model ...
Updating learning rate to 2.824295364810001e-05
Epoch: 16 cost time: 8.517388343811035
Epoch: 16, Steps: 52 | Train Loss: 0.8352281 Vali Loss: 0.2504322 Test Loss: 0.2952975
EarlyStopping counter: 1 out of 20
Updating learning rate to 2.541865828329001e-05
Epoch: 17 cost time: 8.546180963516235
Epoch: 17, Steps: 52 | Train Loss: 0.8326247 Vali Loss: 0.2494426 Test Loss: 0.2953557
EarlyStopping counter: 2 out of 20
Updating learning rate to 2.287679245496101e-05
Epoch: 18 cost time: 8.62989091873169
Epoch: 18, Steps: 52 | Train Loss: 0.8330776 Vali Loss: 0.2501198 Test Loss: 0.2953243
EarlyStopping counter: 3 out of 20
Updating learning rate to 2.0589113209464907e-05
Epoch: 19 cost time: 9.139880180358887
Epoch: 19, Steps: 52 | Train Loss: 0.8311325 Vali Loss: 0.2503456 Test Loss: 0.2953669
EarlyStopping counter: 4 out of 20
Updating learning rate to 1.8530201888518416e-05
Epoch: 20 cost time: 8.649821281433105
Epoch: 20, Steps: 52 | Train Loss: 0.8285352 Vali Loss: 0.2501398 Test Loss: 0.2953241
EarlyStopping counter: 5 out of 20
Updating learning rate to 1.6677181699666577e-05
Epoch: 21 cost time: 8.810247659683228
Epoch: 21, Steps: 52 | Train Loss: 0.8312093 Vali Loss: 0.2508156 Test Loss: 0.2954302
EarlyStopping counter: 6 out of 20
Updating learning rate to 1.5009463529699919e-05
Epoch: 22 cost time: 8.720659732818604
Epoch: 22, Steps: 52 | Train Loss: 0.8291731 Vali Loss: 0.2498476 Test Loss: 0.2954126
EarlyStopping counter: 7 out of 20
Updating learning rate to 1.3508517176729929e-05
Epoch: 23 cost time: 8.823020219802856
Epoch: 23, Steps: 52 | Train Loss: 0.8276232 Vali Loss: 0.2505892 Test Loss: 0.2954237
EarlyStopping counter: 8 out of 20
Updating learning rate to 1.2157665459056936e-05
Epoch: 24 cost time: 8.844355821609497
Epoch: 24, Steps: 52 | Train Loss: 0.8295408 Vali Loss: 0.2494127 Test Loss: 0.2954512
EarlyStopping counter: 9 out of 20
Updating learning rate to 1.0941898913151242e-05
Epoch: 25 cost time: 8.662446975708008
Epoch: 25, Steps: 52 | Train Loss: 0.8274168 Vali Loss: 0.2502550 Test Loss: 0.2954539
EarlyStopping counter: 10 out of 20
Updating learning rate to 9.847709021836118e-06
Epoch: 26 cost time: 8.613507509231567
Epoch: 26, Steps: 52 | Train Loss: 0.8285695 Vali Loss: 0.2502435 Test Loss: 0.2954660
EarlyStopping counter: 11 out of 20
Updating learning rate to 8.862938119652508e-06
Epoch: 27 cost time: 8.640187501907349
Epoch: 27, Steps: 52 | Train Loss: 0.8258014 Vali Loss: 0.2509975 Test Loss: 0.2954891
EarlyStopping counter: 12 out of 20
Updating learning rate to 7.976644307687255e-06
Epoch: 28 cost time: 8.58127737045288
Epoch: 28, Steps: 52 | Train Loss: 0.8254181 Vali Loss: 0.2497662 Test Loss: 0.2955239
EarlyStopping counter: 13 out of 20
Updating learning rate to 7.178979876918531e-06
Epoch: 29 cost time: 8.614110708236694
Epoch: 29, Steps: 52 | Train Loss: 0.8260933 Vali Loss: 0.2514332 Test Loss: 0.2955330
EarlyStopping counter: 14 out of 20
Updating learning rate to 6.4610818892266776e-06
Epoch: 30 cost time: 8.914889812469482
Epoch: 30, Steps: 52 | Train Loss: 0.8269885 Vali Loss: 0.2497415 Test Loss: 0.2955573
EarlyStopping counter: 15 out of 20
Updating learning rate to 5.8149737003040096e-06
Epoch: 31 cost time: 8.636004447937012
Epoch: 31, Steps: 52 | Train Loss: 0.8252504 Vali Loss: 0.2497662 Test Loss: 0.2955500
EarlyStopping counter: 16 out of 20
Updating learning rate to 5.23347633027361e-06
Epoch: 32 cost time: 8.661565065383911
Epoch: 32, Steps: 52 | Train Loss: 0.8235433 Vali Loss: 0.2507012 Test Loss: 0.2955832
EarlyStopping counter: 17 out of 20
Updating learning rate to 4.710128697246249e-06
Epoch: 33 cost time: 8.753333568572998
Epoch: 33, Steps: 52 | Train Loss: 0.8247857 Vali Loss: 0.2507282 Test Loss: 0.2955914
EarlyStopping counter: 18 out of 20
Updating learning rate to 4.239115827521624e-06
Epoch: 34 cost time: 8.644249677658081
Epoch: 34, Steps: 52 | Train Loss: 0.8251123 Vali Loss: 0.2500922 Test Loss: 0.2955860
EarlyStopping counter: 19 out of 20
Updating learning rate to 3.815204244769462e-06
Epoch: 35 cost time: 8.66170597076416
Epoch: 35, Steps: 52 | Train Loss: 0.8243689 Vali Loss: 0.2500066 Test Loss: 0.2956096
EarlyStopping counter: 20 out of 20
Early stopping
>>>>>>>testing : AAPL_336_96_PatchTST_custom_ftM_sl336_ll48_pl96_dm128_nh16_el3_dl1_df256_fc1_ebtimeF_dtTrue_Exp_0<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 1958
mse:0.02535967342555523, mae:0.061059050261974335, rse:1.0113166570663452
